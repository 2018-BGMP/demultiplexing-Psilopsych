---
title: "deMultiplexing"
author: "Nate Olowo"
date: "October 16, 2018"
output: pdf_document
---
## Demultiplexing Assignment
Code developed for paired end reads in which reads and indexes are in seperate files. The following scripts
will output write statistics and a graph of relative sample abundances for the demultiplexing. 

__Usage__ 
DeMultiAlgoArg.py [options]

__Input flags__

_Required_

-r1 [readfile1] 

-i1 [indexfile1] 

-r2 [readfile2] 

-i2 [indexFile2] 

_Optional_

-t [mean quality score threshold] _Default:_ 25

-b [Barcodes mapping file] _Default:_ indexes.txt


### Statistics defined

__Records Read:__ Total number of reads processed in each file. All four files should have the same amount of lines, if not, the script will only read until your shortest file.

__bad Reads:__ N found in barcode of either of the 2 index reads

__Below Threshold:__ Average quality scores of each index read does not surpass threshold. No N's in barcode though

__unmatched indices:__ Indexes don't match. Passes threshold and N tests stated above.

__Not found in indexes file:__ Index of forward read not found in indexes.txt input file. Passes all tests above. 

__Matched Reads:__ Passes all above test. Read written to respective sample with forward and reverse written seperately. Forward index place inline with read headers for forward and reverse reads. 

### Expected output from Test files
Write statisitcs

Records Read:  9

Matched Reads:  2

Below threshold:  1

unmatched indices:  2

bad reads(Ns):  3

Matched barcodes above threshold not found in indexes file:  1

### Output
This script will output 2n+2, where n = # of Barcode IDs found in indexes.txt file.

All bad reads are written to unmatched*.fastq file pairs. 


### Output of 1294 read files. 

``` {r, include = FALSE}
library(tidyverse)
```

__Relative abundancies__

```{r, echo=FALSE, message=FALSE}
samples <- read_csv("samplePerc.csv") %>%
  filter(Reads < 2905973880) %>%
  filter(!grepl("Forward",Sample)) %>%
  mutate(Freq = Reads / sum(Reads))


ggplot(samples, aes(x=reorder(Sample, -Freq), y=Freq, fill=Sample)) +
  geom_bar(stat="identity")+theme_minimal() +
  ylab("Relative Frequency") +
  theme(axis.text.x = element_text(angle = 90, hjust = 1),
  text = element_text(size=8),
  legend.position="none") +
  scale_y_continuous(labels = scales::percent) +
  xlab("Sample ID")

```
__Figure 1:__ Relative abundance of forward and reverse reads of each sample deMultiplexed. Forward and reverse files contain same number of reads. 

__Output Statistics:__

Write statisitcs

Records Read:  363,246,735

Matched reads:  304,980,270

Below threshold:  44,557,157

unmatched indices:  9,499,159

bad reads(Ns):  4,205,183

Matched barcodes above threshold not found in indexes file:  4,966

__Estimated amount of index-hopping__

(9499159) / 363246735 * 100 = 2.6% indexes hoppped

84% matched indexes

__Output Snippets__
``` {r engine = 'bash', eval = FALSE}

head -n 4 A10Forward.fastq
@K00337:83:HJKJNBBXX:8:1101:1763:1701 1:N:0:1:TCGAGAGT
TGTGTAATACATTTCATTTCTTTAATGAAAAGAAAAAAAGTATCTCTAGGGACCAGAGAGATGGCTTAGCAGCTAAGAGCTCTTCTTGAGGACCCTGGTTT
+
AAFAFJJJJJJJJJJJJJJJJJJJJJJJJJJJJJJJJJJJJJJJJJJJJJJJJJJJJJJJJJJJJJJJJJJJJJJJJJJJJJJJJJJJFJJJJJJJJJAJJ

head -n 4 A10Reverse.fastq
@K00337:83:HJKJNBBXX:8:1101:1763:1701 4:N:0:1:TCGAGAGT
CCAAAATTCAGTTATAGAATCTTTCAGAAATCTTTCACTGTGTATAGGTGTTTTGCGTGTAAGCATGTCTTACACCCGTGTATGAGCATTGCCCTTAGAAA
+
AAFFFJJJJJJJJJJJJJJJJJJJJJJJJJJJJJJJJJJJJJJJJJJJJJJJJJJJJJJJJJJJJJJJJJJJJJJJJJJJJJJJJJJJJFFJFFJJJJJJJ
```

``` {r engine = 'bash', eval = FALSE}

```